<script type="text/ng-template" id="suggestionTemplate.html">
	<span>
		<i>({{match.label.feature}})</i> <a style="cursor:pointer">{{match.label.fullTerm}}</a>
	</span>
</script>

<script type="text/ng-template" id="suggestionPopupTemplate.html">
	<div class="suggest-container dropdown-menu"
		ng-style="{top: position().top+'px', left: position().left+'px'}"
		style="display: block;"
		ng-show="isOpen() && !moveInProgress"
		aria-hidden="{{!isOpen()}}">
		<div class="suggest-item" ng-repeat="match in matches track by $index" ng-class="{active: isActive($index) }"
				ng-mouseenter="selectActive($index)" ng-click="selectMatch($index)" role="option" id="{{::match.id}}">
				<span uib-typeahead-match index="$index" match="match" query="query" template-url="templateUrl"></span>
		</div>
	</div>
</script>

<script type="text/ng-template" id="messages.html">
	<div class="modal-header">
		<h3 class="modal-title" ng-bind="modalState">{{modalState}}</h3>
	</div>
	<div class="modal-body" ng-bind="modalMessage">{{modalMessage}}</div>
	<div class="modal-footer">
		<button class="btn btn-primary" type="button" ng-click="okModal()">Ok</button>
		<!--
		<button class="btn btn-warning" type="button" ng-click="cancelModal()">Cancel</button>
		-->
	</div>
</script>

<div ng-class="{fetching: true, show:queryInProgress, hidden: !queryInProgress}" ng-if="true===false" ng-cloak="">
	<uib-progressbar ng-class="{progress-striped: resultsFetched==maxResultsFetched; active: resultsFetched==maxResultsFetched;" value="resultsFetched" max="maxResultsFetched" type="info">{{searchButtonText}}</uib-progressbar>
<h2>Loading</h2>
</div>

<script type="text/ng-template" id="template/tabs/tab.html">
	<li ng-class="{active: active, disabled: disabled}">
		<a ng-click="select()" uib-tab-heading-transclude>{{heading}}</a>
	</li>
</script>

<script type="text/ng-template" id="tooltip/term.html">
	<span><b>Click</b>: switches term&apos;s results<br /><b>Ctrl+Click</b>: focus on term&apos;s results</span>
</script>

<script type="text/ng-template" id="tooltip/closeTab.html">
	<span><b>Click</b>: close this tab<br /><b>Shift+Click</b>: close this tab and modify the query</span>
</script>

<script type="text/ng-template" id="tooltip/chartSwitch.html">
	<span><b>Click</b>: switches chart visibility<br /><b>Ctrl+Click</b>: hide all charts but this<br /><b>Shift+Click</b>: Switch mean series from chart</span>
</script>

<div class="row info" style="padding-top:20px;padding-bottom:20px;">
            <div class="col-xs-12 col-sm-4 col-md-3 col-lg-2 text-center vertical-center" style="max-width: 350px;">
		<div class="row">
			<nvd3 ng-if="subtotals.library==='nvd3'" options="subtotals.options" data="subtotals.data"></nvd3>
			<highchart class="datachart" ng-if="subtotals.library==='highcharts'" config="subtotals.options"></highchart>
		</div>
            </div>
            <div class="col-xs-12 col-sm-4 col-md-6 col-lg-8 text-center">
                <h2>Explore the behaviour of your candidate genes, pathways or genome regions across the Blueprint datasets.</h2>
                <p>The Blueprint project is providing in this release epigenomic analysis from {{samples.length}} samples to the scientific community. Their associated epigenomes are characterized by: gene and transcript expression (from RNA-Seq experiments), hyper and hypo methylated regions (derived from WGBS experiments), chromatin accessibility (DNAse-Seq), and {{numHistones}} Histone marks binding activity (ChIP-Seq)</p>
                <p>Use this tool to explore the behaviour of your gene in the different cell types</p>
                <p>
                <a tooltip-placement="bottom" uib-tooltip="{{getDataDesc()}}"><b>Data release - {{dataRelease}}</b></a>
                </p>           
            </div>
            <div class="col-xs-12 col-sm-4 col-md-3 col-lg-2 text-center vertical-center" style="max-width: 350px;">
		<div class="row">
			<nvd3 ng-if="analysisSubtotals.library==='nvd3'" options="analysisSubtotals.options" data="analysisSubtotals.data"></nvd3>
			<highchart class="datachart" ng-if="analysisSubtotals.library==='highcharts'" config="analysisSubtotals.options"></highchart>
		</div>
            </div>
</div>

  <div class="row">
    <div class="col-sm-12">
      <form class="form-horizontal" role="form">
        <div class="form-group form-group-lg">
	<div class="col-sm-3 text-center">
		<label>Flanking window size (bp)
			<input style="font-weight:normal;" type="number" name="flankingWindow" ng-model="flankingWindowSize" ng-disabled="queryInProgress" min="0" required>
		</label>
		<div class="form-group">
			<label>Stats Tree</label>
			<label style="font-weight:normal;">
				<input type="radio" name="display" ng-model="display" ng-disabled="queryInProgress" value="compact"> Compact
			</label>
			<label style="font-weight:normal;">
				<input type="radio" name="display" ng-model="display" ng-disabled="queryInProgress" value="detailed"> Detailed
			</label>
			<label style="font-weight:normal;">
				<input type="radio" name="display" ng-model="display" ng-disabled="queryInProgress" value="none"> Hide
			</label>
		</div>
	</div>
          <div class="col-sm-6">
		<input id="search" type="text" ng-model="query" ng-keypress="enterSearch($event)" ng-disabled="queryInProgress" placeholder="Search by gene name, Ensembl gene Id, chromosome region or Reactome pathway id" uib-typeahead="suggest for suggest in suggestSearch($viewValue)" typeadhead-loading="loadingSuggestions" typeahead-no-results="noSuggestion" typeahead-popup-template-url="suggestionPopupTemplate.html" typeahead-min-length="3" typeahead-on-select="query=label.term;search($label)" typeahead-template-url="suggestionTemplate.html" class="form-control" style="background:#f5f5f5">
		<i ng-show="loadingSuggestions" class="glyphicon glyphicon-refresh"></i>
		<div ng-show="noSuggestion">
			<i class="glyphicon glyphicon-remove"></i> No Results Found
		</div>
            <!-- <p class="small">Chromosome regions should be shorter than 10Kb</p> -->
	    <p class="text-center">Examples: <a ng-click="query='myc'; search()" style="cursor: pointer;">Myc</a>, <a ng-click="query='TET1'; search()" style="cursor: pointer;">TET1</a>, <a ng-click="query='IRF8'; search()" style="cursor: pointer;">IRF8</a>, <a ng-click="query='NFIB'; search()" style="cursor: pointer;">NFIB</a>, <a ng-click="query='chr1:208856422-208956421'; search()" style="cursor: pointer;">chr1:208856422-208956421</a>, <a ng-click="query='REACT_160159.2'; search()" style="cursor: pointer;">REACT_160159.2</a>, <a ng-click="query='pathway:Cell Cycle, Mitotic'; search()" style="cursor: pointer;">Pathway <i>Cell Cycle, Mitotic</i></a></p>
          </div>
          <div class="col-sm-3 text-center"><button ng-click="search()" ng-disabled="queryInProgress" type="button" class="btn btn-primary btn-bp btn-lg" ng-bind-html="searchButtonText">Search</button></div>
        </div>
      </form>
    </div>
  </div> 

<!--
<p class="text-center" style="margin-bottom:40px;" ng-bind-html="found"></p>
-->
<uib-tabset ng-if="graphData.length &gt; 0">
	<uib-tab ng-repeat="rangeData in graphData" select="doRefresh(rangeData)">
		<uib-tab-heading>{{rangeData.heading}}&nbsp;<i ng-class="{'glyphicon': rangeData.toBeFetched || rangeData.fetching,'glyphicon-download': rangeData.toBeFetched, 'glyphicon-hourglass': rangeData.fetching, 'blink': rangeData.fetching}"></i><i class="hover_red" ng-class="{'glyphicon': !rangeData.fetching,'glyphicon-remove-sign': !rangeData.fetching && $parent.graphData.length > 1}" ng-click="removeTabResult($event,$index);" uib-tooltip-template="'tooltip/closeTab.html'" tooltip-placement="bottom" tooltip-append-to-body></i></uib-tab-heading>
		
		<div class="no-margin-padding text-center">
			<p class="text-center" ng-bind-html="rangeData.queryFound"></p><p class="text-center" ng-bind-html="rangeData.found"></p>
			<div class="btn-group">
				<label class="btn btn-default" ng-repeat="view in $parent.EXPORTED_VIEWS" ng-model="$parent.rangeData.viewClass" uib-btn-radio="view.viewClass" ng-disabled="$parent.rangeData.fetching || $parent.rangeData.toBeFetched" ng-click="redrawCharts(rangeData)">{{view.viewDesc}}</label>
			</div>
		</div>
		
		<!--
			General
		-->
		<div class="no-margin-padding" ng-show="rangeData.viewClass==='General'">
			<!-- This trick allows reflowing the charts which were drawn in background -->
			{{doReflow()}}
			<uib-accordion class="col-xs-12 col-sm-2 col-lg-1">
				<uib-accordion-group heading="Charts" panel-class="panel-info" class="row terms-selector">
					<div class="col-xs-1 col-sm-12 termItem pointer" ng-click="hideAllCharts($event,rangeData)">
						<span class="square" style="border-color: #202020 ; background-color: white;"></span>
						<span class="term">Hide all charts / mean series</span>
					</div>
					<div class="col-xs-1 col-sm-12 termItem pointer" ng-click="showAllCharts($event,rangeData)">
						<span class="square" style="border-color: #202020 ; background-color: #202020;"></span>
						<span class="term">Show all charts / mean series</span>
					</div>
					<div class="col-xs-1 col-sm-12">&nbsp;</div>
					<div class="col-xs-1 col-sm-12 termItem pointer" ng-repeat="chart in getCharts(rangeData,'General')" ng-click="switchChart($event,chart,$parent.rangeData)" ng-hide="chart.isEmpty" uib-tooltip-template="'tooltip/chartSwitch.html'">
						<span class="square" ng-style="{'border-color': chart.bpSideData.meanSeries.color, 'background-color': chart.isHidden ? 'white' : (chart.meanSeriesHidden ? '#E0E0E0': chart.bpSideData.meanSeries.color) }"></span>
						<span class="term" ng-style="{color: chart.isHidden ? 'gray': 'initial'}">{{chart.title}}</span>
					</div>
				</uib-accordion-group>
				<uib-accordion-group heading="Cell Types" panel-class="panel-info" class="row terms-selector">
					<div class="col-xs-1 col-sm-12 termItem pointer" ng-click="hideAllSeries(rangeData)">
						<span class="circle" style="border-color: #202020 ; background-color: white;"></span>
						<span class="term">Hide all cell types</span>
					</div>
					<div class="col-xs-1 col-sm-12 termItem pointer" ng-click="showAllSeries(rangeData)">
						<span class="circle" style="border-color: #202020 ; background-color: #202020;"></span>
						<span class="term">Show all cell types</span>
					</div>
					<div class="col-xs-1 col-sm-12">&nbsp;</div>
					<div class="col-xs-1 col-sm-12 termItem pointer" ng-repeat="termNode in getSeriesNodes(rangeData,'General')" ng-click="switchSeriesNode($event,termNode,$parent.rangeData)" ng-if="termNode.wasSeen" uib-tooltip-template="'tooltip/term.html'" tooltip-popup-delay="500">
						<span class="circle" ng-style="{'border-color': termNode.color, 'background-color': termNode.termHidden ? 'white' : termNode.color }"></span>
						<span class="term" ng-style="{color: termNode.termHidden ? 'gray' : 'initial'}">{{termNode.name}}</span>
					</div>
				</uib-accordion-group>
			</uib-accordion>
			
			<div class="col-xs-12 col-sm-10 col-lg-11 text-center vertical-center">
				<div class="row" style="width:100%">
					<div class="col-md-12 col-lg-6" ng-repeat="chart in getCharts(rangeData,'General')" ng-hide="chart.isEmpty || chart.isHidden">
						<nvd3 class="datachart" ng-if="chart.library==='nvd3'" options="chart.options" data="chart.data"></nvd3>
						<canvasjs class="datachart" ng-if="chart.library==='canvasjs'" config="chart.options"></canvasjs>
						<chartjs class="datachart" ng-if="chart.library==='chartjs'" config="chart.options"></chartjs>
						<highchart class="datachart" ng-if="chart.library==='highcharts'" config="chart.options"></highchart>
					</div>
				</div>
				
				<!-- panel concept
				<div class="panel panel-default" ng-repeat="chart in getCharts(rangeData,'General')">
					<div class="panel-heading">
						<h5 class="panel-title">
							<a ng-click="chart.isClosed = !chart.isClosed"><i class="pull-left glyphicon" ng-class="{'glyphicon-chevron-down': !chart.isClosed, 'glyphicon-chevron-right': chart.isClosed}"></i><span ng-show="chart.isClosed">{{chart.title}}</span><i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': !chart.isClosed, 'glyphicon-chevron-left': chart.isClosed}"></i></a>
						</h5>
					</div>
					<div collapse="chart.isClosed">
						<div class="panel-body">
							<nvd3 class="datachart" ng-if="chart.library==='nvd3'" options="chart.options" data="chart.data"></nvd3>
							<canvasjs class="datachart" ng-if="chart.library==='canvasjs'" options="chart.options" data="chart.data"></canvasjs>
							<highchart class="datachart" ng-if="chart.library==='highcharts'" config="chart.options"></highchart>
						</div>
					</div>
				</div>
				-->
				
				<!-- alternate concept
				<div class="panel panel-default" ng-repeat="ontology in rangeData.treedata">
					<div class="panel-heading">
						<h5 class="panel-title">
							<a ng-click="ontology.isClosed = !ontology.isClosed"><i class="pull-left glyphicon" ng-class="{'glyphicon-chevron-down': !ontology.isClosed, 'glyphicon-chevron-right': ontology.isClosed}"></i><i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': !ontology.isClosed, 'glyphicon-chevron-left': ontology.isClosed}"></i></a>
						</h5>
					</div>
					<div collapse="ontology.isClosed">
						<div class="panel-body">
							<d3-tree data="ontology" label="name" style="display"></d3-tree>      
						</div>
					</div>
				</div>
				-->
			</div>
			
			<div class="row" style="clear:both;">
				<div class="col-sm-1 text-center" style="margin-top:1em;">
					<img ng-src="{{rangeData.ui.gChro.f}}" class="img-responsive img-center vertical-center" title="Chromosome {{rangeData.ui.gChro.n}}">
				</div>
				<div class="col-sm-11">
					<div ng-repeat="ontology in rangeData.treedata">
						<d3-tree data="ontology" label="name" style="display"></d3-tree>      
					</div>
				</div>
			</div>
		</div>
		
		<!--
			By Tissues
		-->
		<div class="no-margin-padding" ng-show="rangeData.viewClass==='Tissues'">
			<!-- Single button -->
			<div class="no-margin-padding text-center">
				<div class="btn-group" uib-dropdown uib-keyboard-nav is-open="rangeData.ui.tissueButtonIsOpen">
					<button id="tissue-button" type="button" class="btn btn-default" style="border:none" uib-dropdown-toggle ng-disabled="rangeData.fetching || rangeData.toBeFetched">
						Tissue: <span class="circle" ng-style="{'border-color': rangeData.ui.tissueSelected.color, 'background-color': rangeData.ui.tissueSelected.color }"></span>{{rangeData.ui.tissueSelected.name}} <span class="caret"></span>
					</button>
					<ul class="uib-dropdown-menu celltype-menu" role="menu" aria-labelledby="tissue-button">
						<li role="menuitem" class="pointer" ng-class="{'celltype-chosen': $parent.rangeData.ui.tissueButtonSelected === $index}" ng-repeat="tissueNode in getGroupBySeriesNodes(rangeData,'Tissues')"><a ng-click="selectGroup($parent.rangeData,$index);"><span class="circle" ng-style="{'border-color': tissueNode.color, 'background-color': tissueNode.color }"></span>{{tissueNode.name}}</a></li>
						<!--
						<li class="divider"></li>
						<li role="menuitem"><a href="#">Separated link</a></li>
						-->
					</ul>
				</div>
			</div>
			<!-- This trick allows reflowing the charts which were drawn in background -->
			{{doReflow()}}
			<div class="col-xs-12 col-sm-2 col-lg-1">
				<div class="row terms-selector">
					<div class="col-xs-1 col-sm-12 termItem pointer" ng-click="hideAllCharts($event,rangeData)">
						<span class="square" style="border-color: #202020 ; background-color: white;"></span>
						<span class="term">Hide all charts / mean series</span>
					</div>
					<div class="col-xs-1 col-sm-12 termItem pointer" ng-click="showAllCharts($event,rangeData)">
						<span class="square" style="border-color: #202020 ; background-color: #202020;"></span>
						<span class="term">Show all charts / mean series</span>
					</div>
					<div class="col-xs-1 col-sm-12">&nbsp;</div>
					<div class="col-xs-1 col-sm-12 termItem pointer" ng-repeat="chart in getCharts(rangeData,'Tissues')" ng-click="switchChart($event,chart,$parent.rangeData)" ng-hide="chart.isEmpty" uib-tooltip-template="'tooltip/chartSwitch.html'">
						<span class="square" ng-style="{'border-color': chart.bpSideData.meanSeries.color, 'background-color': chart.isHidden ? 'white' : (chart.meanSeriesHidden ? '#E0E0E0': chart.bpSideData.meanSeries.color) }"></span>
						<span class="term" ng-style="{color: chart.isHidden ? 'gray': 'initial'}">{{chart.title}}</span>
					</div>
				</div>
				<div class="row terms-selector">
					<div class="col-xs-1 col-sm-12 termItem pointer" ng-click="hideAllSeries(rangeData)">
						<span class="circle" style="border-color: #202020 ; background-color: white;"></span>
						<span class="term">Hide all cell types</span>
					</div>
					<div class="col-xs-1 col-sm-12 termItem pointer" ng-click="showAllSeries(rangeData)">
						<span class="circle" style="border-color: #202020 ; background-color: #202020;"></span>
						<span class="term">Show all cell types</span>
					</div>
					<div class="col-xs-1 col-sm-12">&nbsp;</div>
					<div class="col-xs-1 col-sm-12 termItem pointer" ng-repeat="termNode in getSeriesNodes(rangeData,'Tissues')" ng-click="switchSeriesNode($event,termNode,$parent.rangeData)" ng-if="termNode.wasSeen" uib-tooltip-template="'tooltip/term.html'" tooltip-popup-delay="500">
						<span class="circle" ng-style="{'border-color': termNode.color, 'background-color': termNode.termHidden ? 'white' : termNode.color }"></span>
						<span class="term" ng-style="{color: termNode.termHidden ? 'gray' : 'initial'}">{{termNode.name}}</span>
					</div>
				</div>
			</div>
			
			<div class="col-xs-12 col-sm-10 col-lg-11 text-center vertical-center">
				<div class="row" style="width:100%">
					<div class="col-md-12 col-lg-6" ng-repeat="chart in getCharts(rangeData,'Tissues')" ng-hide="chart.isEmpty || chart.isHidden">
						<nvd3 class="datachart" ng-if="chart.library==='nvd3'" options="chart.options" data="chart.data"></nvd3>
						<canvasjs class="datachart" ng-if="chart.library==='canvasjs'" config="chart.options"></canvasjs>
						<chartjs class="datachart" ng-if="chart.library==='chartjs'" config="chart.options"></chartjs>
						<highchart class="datachart" ng-if="chart.library==='highcharts'" config="chart.options"></highchart>
					</div>
				</div>
			</div>
		</div>
		
		<!--
			By Diseases
		-->
		<div class="no-margin-padding" ng-show="rangeData.viewClass === 'Diseases'">
			<!-- Single button -->
			<div class="no-margin-padding text-center">
				<div class="btn-group" uib-dropdown uib-keyboard-nav is-open="rangeData.ui.celltypeButtonIsOpen">
					<button id="celltype-button" type="button" class="btn btn-default" style="border:none" uib-dropdown-toggle ng-disabled="rangeData.fetching || rangeData.toBeFetched">
						Cellular type: <span class="circle" ng-style="{'border-color': rangeData.ui.celltypeSelected.color, 'background-color': rangeData.ui.celltypeSelected.color }"></span>{{rangeData.ui.celltypeSelected.name}} <span class="caret"></span>
					</button>
					<ul class="uib-dropdown-menu celltype-menu" role="menu" aria-labelledby="celltype-button">
						<li role="menuitem" class="pointer" ng-class="{'celltype-chosen': $parent.rangeData.ui.celltypeButtonSelected === $index}" ng-repeat="termNode in getGroupBySeriesNodes(rangeData,'Diseases')"><a ng-click="selectGroup($parent.rangeData,$index);"><span class="circle" ng-style="{'border-color': termNode.color, 'background-color': termNode.color }"></span>{{termNode.name}}</a></li>
						<!--
						<li class="divider"></li>
						<li role="menuitem"><a href="#">Separated link</a></li>
						-->
					</ul>
				</div>
			</div>
			<!-- This trick allows reflowing the charts which were drawn in background -->
			{{doReflow()}}
			<div class="col-xs-12 col-sm-2 col-lg-1">
				<div class="row terms-selector">
					<div class="col-xs-1 col-sm-12 termItem pointer" ng-click="hideAllSeries(rangeData)">
						<span class="circle" style="border-color: #202020 ; background-color: white;"></span>
						<span class="term">Hide all cell types</span>
					</div>
					<div class="col-xs-1 col-sm-12 termItem pointer" ng-click="showAllSeries(rangeData)">
						<span class="circle" style="border-color: #202020 ; background-color: #202020;"></span>
						<span class="term">Show all cell types</span>
					</div>
					<div class="col-xs-1 col-sm-12">&nbsp;</div>
					<div class="col-xs-1 col-sm-12 termItem pointer" ng-repeat="diseaseNode in getSeriesNodes(rangeData,'Diseases')" ng-click="switchSeriesNode($event,diseaseNode,$parent.rangeData)" ng-if="diseaseNode.wasSeen" uib-tooltip-template="'tooltip/term.html'" tooltip-popup-delay="500">
						<span class="circle" ng-style="{'border-color': diseaseNode.color, 'background-color': diseaseNode.termHidden ? 'white' : diseaseNode.color }"></span>
						<span class="term" ng-style="{color: diseaseNode.termHidden ? 'gray' : 'initial'}">{{diseaseNode.name}}</span>
					</div>
				</div>
				<div class="row terms-selector">
					<div class="col-xs-1 col-sm-12 termItem pointer" ng-click="hideAllCharts($event,rangeData)">
						<span class="square" style="border-color: #202020 ; background-color: white;"></span>
						<span class="term">Hide all charts / mean series</span>
					</div>
					<div class="col-xs-1 col-sm-12 termItem pointer" ng-click="showAllCharts($event,rangeData)">
						<span class="square" style="border-color: #202020 ; background-color: #202020;"></span>
						<span class="term">Show all charts / mean series</span>
					</div>
					<div class="col-xs-1 col-sm-12">&nbsp;</div>
					<div class="col-xs-1 col-sm-12 termItem pointer" ng-repeat="chart in getCharts(rangeData,'Diseases')" ng-click="switchChart($event,chart,$parent.rangeData)" ng-hide="chart.isEmpty" uib-tooltip-template="'tooltip/chartSwitch.html'">
						<span class="square" ng-style="{'border-color': chart.bpSideData.meanSeries.color, 'background-color': chart.isHidden ? 'white' : (chart.meanSeriesHidden ? '#E0E0E0': chart.bpSideData.meanSeries.color) }"></span>
						<span class="term" ng-style="{color: chart.isHidden ? 'gray': 'initial'}">{{chart.title}}</span>
					</div>
				</div>
			</div>
			<div class="col-xs-12 col-sm-10 col-lg-11 text-center vertical-center">
				<div class="row" style="width:100%">
					<div class="col-md-12 col-lg-6" ng-repeat="chart in getCharts(rangeData,'Diseases')" ng-hide="chart.isEmpty || chart.isHidden">
						<nvd3 class="datachart" ng-if="chart.library==='nvd3'" options="chart.options" data="chart.data"></nvd3>
						<canvasjs class="datachart" ng-if="chart.library==='canvasjs'" config="chart.options"></canvasjs>
						<chartjs class="datachart" ng-if="chart.library==='chartjs'" config="chart.options"></chartjs>
						<highchart class="datachart" ng-if="chart.library==='highcharts'" config="chart.options"></highchart>
					</div>
				</div>
			</div>
		</div>
	</uib-tab>
</uib-tabset>
</div>
